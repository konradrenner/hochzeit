!function(t,e){"use strict";if(!e)throw new Error("Filterizr requires jQuery to work.");var r=function(t){this.init(t)};r.prototype={init:function(t){this.root={x:0,y:0,w:t}},fit:function(t){var e,r,i,n=t.length,o=n>0?t[0].h:0;for(this.root.h=o,e=0;n>e;e++)i=t[e],(r=this.findNode(this.root,i.w,i.h))?i.fit=this.splitNode(r,i.w,i.h):i.fit=this.growDown(i.w,i.h)},findNode:function(t,e,r){return t.used?this.findNode(t.right,e,r)||this.findNode(t.down,e,r):e<=t.w&&r<=t.h?t:null},splitNode:function(t,e,r){return t.used=!0,t.down={x:t.x,y:t.y+r,w:t.w,h:t.h-r},t.right={x:t.x+e,y:t.y,w:t.w-e,h:r},t},growDown:function(t,e){var r;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+e,down:{x:0,y:this.root.h,w:this.root.w,h:e},right:this.root},(r=this.findNode(this.root,t,e))?this.splitNode(r,t,e):null}},e.fn.filterizr=function(){var t=this,r=arguments;if(t._fltr||(t._fltr=e.fn.filterizr.prototype.init(t.selector,"object"==typeof r[0]?r[0]:void 0)),"string"==typeof r[0]){if(r[0].lastIndexOf("_")>-1)throw new Error("Filterizr error: You cannot call private methods");if("function"!=typeof t._fltr[r[0]])throw new Error("Filterizr error: There is no such function");t._fltr[r[0]](r[1],r[2])}return t},e.fn.filterizr.prototype={init:function(t,r){var i=e(t).extend(e.fn.filterizr.prototype);return i.options={animationDuration:.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",selector:"string"==typeof t?t:".filtr-container",setupControls:!0},0===arguments.length&&(t=i.options.selector,r=i.options),1===arguments.length&&"object"==typeof arguments[0]&&(r=arguments[0]),r&&i.setOptions(r),i.css({padding:0,position:"relative"}),i._lastCategory=0,i._isAnimating=!1,i._mainArray=i._getFiltrItems(),i._subArrays=i._makeSubarrays(),i._activeArray=i._getCollectionByFilter(i.options.filter),i._toggledCategories={},i._typedText=e("input[data-search]").val()||"",i._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,r="x"==t?e:3&e|8;return r.toString(16)}),i._setupEvents(),i.options.setupControls&&i._setupControls(),i.filter(i.options.filter),i},filter:function(t){var e=this,r=e._getCollectionByFilter(t);e.options.filter=t,e.trigger("filteringStart"),e._handleFiltering(r),e._isSearchActivated()&&e.search(e._typedText)},toggleFilter:function(t){var e=this,r=[];e.trigger("filteringStart"),e._toggledCategories[t]?delete e._toggledCategories[t]:e._toggledCategories[t]=!0,e._multifilterModeOn()?(r=e._makeMultifilterArray(),e._handleFiltering(r),e._isSearchActivated()&&e.search(e._typedText)):(e.filter("all"),e._isSearchActivated()&&e.search(e._typedText))},search:function(t){var e=this,r=e._multifilterModeOn()?e._makeMultifilterArray():e._getCollectionByFilter(e.options.filter),i=[],n=0;if(e._isSearchActivated())for(n=0;n<r.length;n++){var o=r[n].text().toLowerCase().indexOf(t.toLowerCase())>-1;o&&i.push(r[n])}if(i.length>0)e._handleFiltering(i);else if(e._isSearchActivated())for(n=0;n<e._activeArray.length;n++)e._activeArray[n]._filterOut();else e._handleFiltering(r)},shuffle:function(){var t=this;t._mainArray=t._fisherYatesShuffle(t._mainArray),t._subArrays=t._makeSubarrays();var e=t._multifilterModeOn()?t._makeMultifilterArray():t._getCollectionByFilter(t.options.filter);t._isSearchActivated()?t.search(t._typedText):t._placeItems(e)},sort:function(t,e){var r=this;t=t||"domIndex",e=e||"asc";var i="domIndex"!==t&&"sortData"!==t&&"w"!==t&&"h"!==t;if(i)for(var n=0;n<r._mainArray.length;n++)r._mainArray[n][t]=r._mainArray[n].data(t);r._mainArray.sort(r._comparator(t,e)),r._subArrays=r._makeSubarrays();var o=r._multifilterModeOn()?r._makeMultifilterArray():r._getCollectionByFilter(r.options.filter);r._isSearchActivated()?r.search(r._typedText):r._placeItems(o)},setOptions:function(t){var e=this,r=0;for(var i in t)e.options[i]=t[i];if(e._mainArray&&(t.animationDuration||t.delay||t.easing||t.delayMode))for(r=0;r<e._mainArray.length;r++)e._mainArray[r].css("transition","all "+e.options.animationDuration+"s "+e.options.easing+" "+e._mainArray[r]._calcDelay()+"ms");e.options.filterInCss.transform||(e.options.filterInCss.transform="translate3d(0,0,0)"),e.options.filterOutCss.transform||(e.options.filterOutCss.transform="translate3d(0,0,0)")},_getFiltrItems:function(){var t=this,r=e(t.find(".filtr-item")),n=[];return e.each(r,function(r,o){var a=e(o).extend(i)._init(r,t);n.push(a)}),n},_makeSubarrays:function(){for(var t=this,e=[],r=0;r<t._lastCategory;r++)e.push([]);for(r=0;r<t._mainArray.length;r++)if("object"==typeof t._mainArray[r]._category)for(var i in t._mainArray[r]._category)e[t._mainArray[r]._category[i]-1].push(t._mainArray[r]);else e[t._mainArray[r]._category-1].push(t._mainArray[r]);return e},_makeMultifilterArray:function(){for(var t=this,e=[],r={},i=0;i<t._mainArray.length;i++){var n=t._mainArray[i],o=!1,a=n.domIndex in r==!1;if(Array.isArray(n._category)){for(var s=0;s<n._category.length;s++)if(n._category[s]in t._toggledCategories){o=!0;break}}else n._category in t._toggledCategories&&(o=!0);a&&o&&(r[n.domIndex]=!0,e.push(n))}return e},_setupControls:function(){var t=this;e("*[data-filter]").click(function(){var r=e(this).data("filter");t.options.filter!==r&&t.filter(r)}),e("*[data-multifilter]").click(function(){var r=e(this).data("multifilter");"all"===r?(t._toggledCategories={},t.filter("all")):t.toggleFilter(r)}),e("*[data-shuffle]").click(function(){t.shuffle()}),e("*[data-sortAsc]").click(function(){var r=e("*[data-sortOrder]").val();t.sort(r,"asc")}),e("*[data-sortDesc]").click(function(){var r=e("*[data-sortOrder]").val();t.sort(r,"desc")}),e("input[data-search]").keyup(function(){t._typedText=e(this).val(),t._delayEvent(function(){t.search(t._typedText)},250,t._uID)})},_setupEvents:function(){var r=this;e(t).resize(function(){r._delayEvent(function(){r.trigger("resizeFiltrContainer")},250,r._uID)}),r.on("resizeFiltrContainer",function(){r._multifilterModeOn()?r.toggleFilter():r.filter(r.options.filter)}).on("filteringStart",function(){r.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){r.options.callbacks.onFilteringEnd()})},_calcItemPositions:function(){var t=this,i=t._activeArray,n=0,o=Math.round(t.width()/t.find(".filtr-item").outerWidth()),a=0,s=i[0].outerWidth(),l=0,f=0,u=0,c=0,_=0,h=[];if("packed"===t.options.layout){e.each(t._activeArray,function(t,e){e._updateDimensions()});var d=new r(t.outerWidth());for(d.fit(t._activeArray),c=0;c<i.length;c++)h.push({left:i[c].fit.x,top:i[c].fit.y});n=d.root.h}if("horizontal"===t.options.layout)for(a=1,c=1;c<=i.length;c++)s=i[c-1].outerWidth(),l=i[c-1].outerHeight(),h.push({left:f,top:u}),f+=s,l>n&&(n=l);else if("vertical"===t.options.layout){for(c=1;c<=i.length;c++)l=i[c-1].outerHeight(),h.push({left:f,top:u}),u+=l;n=u}else if("sameHeight"===t.options.layout){a=1;var g=t.outerWidth();for(c=1;c<=i.length;c++){s=i[c-1].width();var p=i[c-1].outerWidth(),y=0;i[c]&&(y=i[c].width()),h.push({left:f,top:u}),_=f+s+y,_>g?(_=0,f=0,u+=i[0].outerHeight(),a++):f+=p}n=a*i[0].outerHeight()}else if("sameWidth"===t.options.layout){for(c=1;c<=i.length;c++){if(h.push({left:f,top:u}),c%o===0&&a++,f+=s,u=0,a>0)for(_=a;_>0;)u+=i[c-o*_].outerHeight(),_--;c%o===0&&(f=0)}for(c=0;o>c;c++){for(var m=0,v=c;i[v];)m+=i[v].outerHeight(),v+=o;m>n?(n=m,m=0):m=0}}else if("sameSize"===t.options.layout){for(c=1;c<=i.length;c++)h.push({left:f,top:u}),f+=s,c%o===0&&(u+=i[0].outerHeight(),f=0);a=Math.ceil(i.length/o),n=a*i[0].outerHeight()}return t.css("height",n),h},_handleFiltering:function(t){for(var e=this,r=e._getArrayOfUniqueItems(e._activeArray,t),i=0;i<r.length;i++)r[i]._filterOut();e._activeArray=t,e._placeItems(t)},_multifilterModeOn:function(){var t=this;return Object.keys(t._toggledCategories).length>0},_isSearchActivated:function(){var t=this;return t._typedText.length>0},_placeItems:function(t){var e=this;e._isAnimating=!0,e._itemPositions=e._calcItemPositions();for(var r=0;r<t.length;r++)t[r]._filterIn(e._itemPositions[r])},_getCollectionByFilter:function(t){var e=this;return"all"===t?e._mainArray:e._subArrays[t-1]},_makeDeepCopy:function(t){var e={};for(var r in t)e[r]=t[r];return e},_comparator:function(t,e){return function(r,i){return"asc"===e?r[t]<i[t]?-1:r[t]>i[t]?1:0:"desc"===e?i[t]<r[t]?-1:i[t]>r[t]?1:0:void 0}},_getArrayOfUniqueItems:function(t,e){var r,i,n=[],o={},a=e.length;for(r=0;a>r;r++)o[e[r].domIndex]=!0;for(a=t.length,r=0;a>r;r++)i=t[r],i.domIndex in o||n.push(i);return n},_delayEvent:function(){var t={};return function(e,r,i){if(null===i)throw Error("UniqueID needed");t[i]&&clearTimeout(t[i]),t[i]=setTimeout(e,r)}}(),_fisherYatesShuffle:function(t){for(var e,r,i=t.length;i;)r=Math.floor(Math.random()*i--),e=t[i],t[i]=t[r],t[r]=e;return t}};var i={_init:function(t,e){var r=this;return r._parent=e,r._category=r._getCategory(),r._lastPos={},r.domIndex=t,r.sortData=r.data("sort"),r.w=0,r.h=0,r._isFilteredOut=!0,r._filteringOut=!1,r._filteringIn=!1,r.css(e.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+e.options.animationDuration+"s "+e.options.easing+" "+r._calcDelay()+"ms"}),r.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){r._onTransitionEnd()}),r},_updateDimensions:function(){var t=this;t.w=t.outerWidth(),t.h=t.outerHeight()},_calcDelay:function(){var t=this,e=0;return"progressive"===t._parent.options.delayMode?e=t._parent.options.delay*t.domIndex:t.domIndex%2===0&&(e=t._parent.options.delay),e},_getCategory:function(){var t=this,e=t.data("category");if("string"==typeof e){e=e.split(", ");for(var r in e){if(isNaN(parseInt(e[r])))throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.");e[r]>t._parent._lastCategory&&(t._parent._lastCategory=e[r])}}else e>t._parent._lastCategory&&(t._parent._lastCategory=e);return e},_onTransitionEnd:function(){var t=this;t._filteringOut?(e(t).addClass("filteredOut"),t._isFilteredOut=!0,t._filteringOut=!1):t._filteringIn&&(t._isFilteredOut=!1,t._filteringIn=!1),t._parent._isAnimating&&(t._parent.trigger("filteringEnd"),t._parent._isAnimating=!1)},_filterOut:function(){var t=this,e=t._parent._makeDeepCopy(t._parent.options.filterOutCss);e.transform+=" translate3d("+t._lastPos.left+"px,"+t._lastPos.top+"px, 0)",t.css(e),t._filteringOut=!0},_filterIn:function(t){var r=this,i=r._parent._makeDeepCopy(r._parent.options.filterInCss);e(r).removeClass("filteredOut"),r._filteringIn=!0,r._lastPos=t,i.transform+=" translate3d("+t.left+"px,"+t.top+"px, 0)",r.css(i)}}}(this,jQuery);
